<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuji Simulation</title>
    <style>
        :root {
            --primary: #ff5e57;
            --secondary: #2f3542;
            --bg: #f1f2f6;
            --card-w: 200px;
            --card-h: 300px;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background: var(--bg);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        /* --- ì„¤ì • í™”ë©´ --- */
        #setup-screen {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 400px;
            width: 90%;
            z-index: 10;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--secondary);
        }

        .input-group input {
            width: 80%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
        }

        button.start-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s;
        }
        button.start-btn:hover { transform: scale(1.05); }

        /* --- ê²Œì„ í™”ë©´ --- */
        #game-screen {
            display: none; /* ì´ˆê¸°ì—” ìˆ¨ê¹€ */
            flex-direction: column;
            align-items: center;
            width: 100%;
            height: 100vh;
            position: relative;
        }

        /* ìƒë‹¨ í˜„í™©íŒ */
        .status-board {
            position: absolute;
            top: 20px;
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            z-index: 5;
        }

        /* ë©”ì¸ ì¹´ë“œ ì˜ì—­ */
        .card-stage {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
            position: relative;
        }

        .card {
            width: var(--card-w);
            height: var(--card-h);
            background: linear-gradient(135deg, #2f3542, #57606f);
            border-radius: 15px;
            position: absolute;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
            border: 4px solid white;
            backface-visibility: hidden;
            transition: transform 0.5s ease, opacity 0.3s;
            cursor: pointer;
        }

        /* ì¹´ë“œ ë’·ë©´ íŒ¨í„´ (ì¿ ì§€ ëŠë‚Œ) */
        .card::before {
            content: "KUJI";
            font-size: 3rem;
            opacity: 0.1;
            transform: rotate(-45deg);
        }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .controls {
            position: absolute;
            bottom: 50px;
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .btn {
            border: none;
            padding: 15px;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .btn:active { transform: scale(0.9); }

        .btn-shuffle { background: #ffa502; color: white; }
        .btn-pass { background: #747d8c; color: white; }
        
        .btn-draw { 
            width: 90px; 
            height: 90px; 
            background: var(--primary); 
            color: white; 
            font-size: 1.5rem;
            font-weight: bold;
            border: 4px solid white;
            z-index: 10;
        }

        /* --- ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ --- */
        /* ì„ê¸°: í”ë“¤ë¦¼ */
        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(5deg) translateX(5px); }
            50% { transform: rotate(-5deg) translateX(-5px); }
            75% { transform: rotate(5deg) translateX(5px); }
            100% { transform: rotate(0deg); }
        }
        .anim-shake { animation: shake 0.5s ease-in-out; }

        /* ë„˜ê¸°ê¸°: ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¬ë¼ì´ë“œ í›„ ì‚¬ë¼ì§ */
        .anim-pass {
            transform: translateX(200%) rotate(20deg) !important;
            opacity: 0;
        }

        /* ë½‘ê¸° ê²°ê³¼ ëª¨ë‹¬ */
        #result-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(5px);
        }
        .result-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .rank-text {
            font-size: 5rem;
            font-weight: 900;
            color: var(--primary);
            margin: 20px 0;
            display: block;
        }

        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

    </style>
</head>
<body>

    <div id="setup-screen">
        <h2>ğŸ·ï¸ ì¿ ì§€ ì‹œë®¬ë ˆì´ì…˜ ì„¤ì •</h2>
        <p style="color:#666; font-size:0.9rem;">ê° ìƒì˜ ê°¯ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
        <div class="input-grid" id="input-container">
            </div>
        <button class="start-btn" onclick="startGame()">ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘!</button>
    </div>

    <div id="game-screen">
        <div class="status-board">
            ë‚¨ì€ ì¿ ì§€: <span id="remain-count" style="color:var(--primary); font-weight:bold;">0</span>ê°œ
        </div>

        <div class="card-stage">
            <div class="card" style="transform: rotate(-3deg) scale(0.95); z-index: 1; background:#444;"></div>
            <div class="card" style="transform: rotate(2deg) scale(0.98); z-index: 2; background:#555;"></div>
            
            <div class="card" id="main-card" style="z-index: 3;">
                ?
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-shuffle" onclick="actionShuffle()">
                <span>ğŸ”„<br><small style="font-size:0.6rem">ì„ê¸°</small></span>
            </button>
            <button class="btn btn-draw" onclick="actionDraw()">
                PICK
            </button>
            <button class="btn btn-pass" onclick="actionPass()">
                <span>â­ï¸<br><small style="font-size:0.6rem">ë„˜ê¸°ê¸°</small></span>
            </button>
        </div>
    </div>

    <div id="result-modal" onclick="closeModal()">
        <div class="result-content" onclick="event.stopPropagation()">
            <h2>ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
            <span class="rank-text" id="result-rank">A</span>
            <p>í™”ë©´ì„ í„°ì¹˜í•˜ë©´ ê³„ì†í•©ë‹ˆë‹¤.</p>
        </div>
    </div>

    <script>
        const prizes = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L'];
        let kujiPool = []; // ì‹¤ì œ ì¿ ì§€ë“¤ì´ ë“¤ì–´ìˆëŠ” ë°°ì—´

        // ì´ˆê¸° ì…ë ¥ì¹¸ ìƒì„±
        const inputContainer = document.getElementById('input-container');
        prizes.forEach(rank => {
            const div = document.createElement('div');
            div.className = 'input-group';
            div.innerHTML = `
                <label>${rank}ìƒ</label>
                <input type="number" id="input-${rank}" value="${rank === 'A' ? 1 : 5}" min="0">
            `;
            inputContainer.appendChild(div);
        });

        // ê²Œì„ ì‹œì‘ ë¡œì§
        function startGame() {
            kujiPool = [];
            let total = 0;

            prizes.forEach(rank => {
                const count = parseInt(document.getElementById(`input-${rank}`).value) || 0;
                for(let i=0; i<count; i++) {
                    kujiPool.push(rank);
                }
                total += count;
            });

            if (total === 0) {
                alert("ìµœì†Œ 1ê°œ ì´ìƒì˜ ì¿ ì§€ë¥¼ ë„£ì–´ì£¼ì„¸ìš”!");
                return;
            }

            // ë°°ì—´ ì´ˆê¸° ëœë¤ ì„ê¸°
            shuffleArray(kujiPool);

            // í™”ë©´ ì „í™˜
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            updateStatus();
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus() {
            document.getElementById('remain-count').innerText = kujiPool.length;
        }

        // [ì„ê¸°] ë²„íŠ¼ ì•¡ì…˜
        function actionShuffle() {
            if(kujiPool.length === 0) return;
            
            const card = document.getElementById('main-card');
            
            // ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ ì¶”ê°€ ë° ì œê±°
            card.classList.add('anim-shake');
            
            // ì‹¤ì œ ë°ì´í„° ì„ê¸°
            shuffleArray(kujiPool);
            
            setTimeout(() => {
                card.classList.remove('anim-shake');
            }, 500);
        }

        // [ë„˜ê¸°ê¸°] ë²„íŠ¼ ì•¡ì…˜ (ë§¨ ìœ„ ì¹´ë“œë¥¼ ë§¨ ì•„ë˜ë¡œ ë³´ëƒ„)
        function actionPass() {
            if(kujiPool.length <= 1) return; // 1ê°œë©´ ë„˜ê¸°ê¸° ì˜ë¯¸ ì—†ìŒ

            const card = document.getElementById('main-card');
            
            // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ ë‚ ì•„ê°€ëŠ” ì• ë‹ˆë©”ì´ì…˜
            card.classList.add('anim-pass');

            setTimeout(() => {
                // ë°ì´í„° ì¡°ì‘: ë§¨ ì• ìš”ì†Œë¥¼ ë§¨ ë’¤ë¡œ
                const passedItem = kujiPool.shift();
                kujiPool.push(passedItem);

                // ì¹´ë“œ ì›ìœ„ì¹˜ (ì• ë‹ˆë©”ì´ì…˜ ì œê±°)
                card.classList.remove('anim-pass');
            }, 300);
        }

        // [ë½‘ê¸°] ë²„íŠ¼ ì•¡ì…˜
        function actionDraw() {
            if(kujiPool.length === 0) {
                alert("ëª¨ë“  ì¿ ì§€ê°€ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤!");
                location.reload();
                return;
            }

            // ê²°ê³¼ ë½‘ê¸° (ë°°ì—´ì˜ ì²«ë²ˆì§¸ ìš”ì†Œ)
            const result = kujiPool.shift();
            
            // ê²°ê³¼ ë³´ì—¬ì£¼ê¸°
            document.getElementById('result-rank').innerText = result + "ìƒ";
            document.getElementById('result-modal').style.display = 'flex';
            
            updateStatus();
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('result-modal').style.display = 'none';
            if(kujiPool.length === 0) {
                alert("ì¢…ë£Œ! ì„¤ì • í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.");
                location.reload();
            }
        }

        // Fisher-Yates ì…”í”Œ ì•Œê³ ë¦¬ì¦˜
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
    </script>
</body>
</html>
